getwd()

list.files()


# pacotes instalados 

install.packages("dplyr")
install.packages("reshape2")
install.packages("data.table")

# bibliotecas usas no trabalho

library(reshape2)
library(data.table)
library(dplyr)



dados = read.csv("Movie_ratings.csv")

#tipos de dados

dim(dados)
str(dados)
View(dados)
summary(dados)
levels(dados$critic)
levels(dados$title)

# variáveis
dados
dados$critic
dados$critic <- as.factor(dados$critic)

dados$title
dados$title <- as.factor(dados$title)

#formanto os dados em forma de uma matriz


movie_ratings = as.data.frame(acast(dados, title~critic, value.var = "rating"))
movie_ratings
View(movie_ratings)

m <- cor(movie_ratings)
View(m)



sim_user = cor(movie_ratings[,1:6], use = "complete.obs")
View(sim_user)
sim_user[,6]


#fun��o para separar filmes ainda sem notas
#fazendo o isolamento dos filmes sem notas

rating_critic = setDT(movie_ratings[colnames(movie_ratings)[6]], keep.rownames = TRUE)[]
names(rating_critic) = c('title','rating')


title_na_critic = rating_critic$title[is.na(rating_critic$rating)]
ratings_t = dados[dados$title %in% title_na_critic,]
View(ratings_t)


#incrementando um valor de correla��o para cada usu�rio

x = (setDT(data.frame(sim_user[,6]), keep.rownames = TRUE)[])
names(x) = c('critic','similarity')
ratings_t = merge(x = ratings_t, y = x, by ="critic", all.x = TRUE)
View(ratings_t)

#realizado um media para pontuar os itens com as notas e os valores do resultado similar

ratings_t$sim_rating = ratings_t$rating * ratings_t$similarity
View(ratings_t)


#analisando filmes sem notas

result = ratings_t %>% group_by(title) %>% summarise(sum(sim_rating)/ sum(similarity))
View(result)









